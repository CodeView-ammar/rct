{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list %}

{% block result_list %}
{% if actions_on_top %}
    {% if cl.search_fields or action_form or cl.has_filters %}
        <div class="bg-gray-50 flex flex-col gap-3 mb-4 p-3 rounded-md lg:flex-row dark:bg-gray-800">
            {% block search %}
                {% search_form cl %}
            {% endblock %}

            {% if action_form %}
                {% admin_actions %}
            {% endif %}

            {% block filters %}
                {% if cl.has_filters %}
                    <a class="{% if cl.has_active_filters %}bg-primary-600 border-primary-600 text-white{% else %}bg-white text-gray-500 hover:text-gray-700 dark:bg-gray-900 dark:border-gray-700 dark:hover:text-gray-200 dark:text-gray-400{% endif %} border cursor-pointer flex font-medium group items-center px-3 py-2 rounded-md shadow-sm text-sm lg:ml-auto md:mt-0" x-on:click="filterOpen = true" x-on:keydown.escape.window="filterOpen = false">
                        {% trans "Filters" %}

                        <span class="material-symbols-outlined md-18 ml-auto -mr-1 pl-4 {% if cl.has_active_filters %}text-white{% else %}text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-200 dark:text-gray-500{% endif %}">filter_list</span>
                    </a>
                {% endif %}
            {% endblock %}
        </div>
    {% endif %}
{% endif %}
<form id="task-list-form" method="post">
    {% csrf_token %}
                        <table id="result_list" class="block border-gray-200 border-spacing-none border-separate text-gray-700 w-full dark:text-gray-400 lg:table">
    <thead>
    <tr>
           
        <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell" scope="col">
            <div class="flex items-center">
                <div class="text">
                    
                        
                            <span>الاسبوع</span>
                    </div>
                </div>
                
            </th>
        
            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell" scope="col">
                <div class="flex items-center">
                    <div class="text">
            
                
                    
                        <span>التاريخ</span>
                    
                </div></div>
            </th>
            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell" scope="col">
                <div class="flex items-center">
                    <div class="text">
            
                    
                <span>المهام</span>
        </div></div>    
        
    </th>
        
    </tr>
    </thead>
    <tbody class="block lg:table-row-group">
        
        {% for week_data in extra_context %}

        <tr class=" block border mb-3 rounded-md shadow-sm lg:table-row lg:border-none lg:mb-0 lg:shadow-none dark:border-gray-800">
            
                
                    
            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800" data-label="task" >
                {{week_data.week_name}}

            </td>
                    
                <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800" data-label="task">                                        
                    {{ week_data.week__date}}
                </td>
                    
                <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800" data-label="task">                                        
             
                    <table class="block border-gray-200 border-spacing-none border-separate text-gray-700 w-full dark:text-gray-400 lg:table">
                        <thead style="background-color:rgb(74, 18, 230)">

                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">رقم المهمة</th>
                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">المهمة</th>
                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">اسم المسؤول</th>
                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">الإنجاز</th>
                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">الملاحظة</th>
                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">الملف</th>
                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">تحرير</th>
                            <th class="align-middle font-medium py-2 text-right text-gray-400 text-sm whitespace-nowrap column-Week hidden px-3 lg:table-cell">حذف</th>
                        </thead>
                        <tbody>
                            {% for task_name_ in week_data.tasks %}
                            <tr>

                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800">{{task_name_.id}}</td>
                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800"> <a href=/app/todo/task/{{task_name_.id}}/change/?_changelist_filters=e%3D1>{{task_name_.name_task}}</a></td>
                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800">{{task_name_.head_department}}</td>
                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800"> <input type="checkbox" name="task_{{ task_name_.id }}_done" {% if task_name_.done %}checked{% endif %}
                                class="appearance-none bg-gray-300 cursor-pointer h-5 relative rounded-full transition-all w-8 after:absolute after:bg-white after:content-[''] after:bg-red-300 after:h-3 after:rounded-full after:shadow-sm after:left-1 after:top-1 after:w-3 checked:bg-primary-600 checked:after:left-4 dark:bg-gray-600"></td>
                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800">{{task_name_.note}}</td>
                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800">{{task_name_.file}}</td>
                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800"><a href=/app/todo/task/{{task_name_.id}}/change/?_changelist_filters=e%3D1>تعديل</a></td>
                            <td class="field-name_task align-middle flex border-t border-gray-200 font-normal gap-4 min-w-0 overflow-hidden px-3 py-2 text-right text-gray-500 text-sm before:flex before:capitalize before:content-[attr(data-label)] before:items-center before:mr-auto before:text-gray-500 first:border-t-0 dark:before:text-gray-400 dark:text-gray-400 lg:before:hidden lg:first:border-t lg:py-3 lg:table-cell dark:border-gray-800"><a href=/app/todo/task/{{task_name_.id}}/delete/?_changelist_filters=e%3D1>حذف</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                </td>
            </tr>                                
            {% endfor %}
        </tbody>
        
    </table>
    <button type="submit"    class="default">Save</button>
</form>
{% block extrahead %}
{{ block.super }}
<script>
    $("#task-list-form").on("submit", function(event) {
       alert("a");
           event.preventDefault();
           const formData = new FormData(this);
           fetch("{% url 'admin:save_task_list' %}", {
             method: "POST",
             body: formData
           })
           .then(function(response) {
             if (response.ok) {
               alert("Task list saved successfully.");
               return false;
             } else {
               alert("Error saving task list.");
             }
           })
           .catch(function(error) {
             alert("Error saving task list: " + error);
           });
         });
     </script>
     {% endblock %}
{% block pagination %}
    {% pagination cl %}
{% endblock %}
{% endblock %}

